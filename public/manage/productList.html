<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="assets/font-awesome/css/font-awesome.css">
        <link rel="stylesheet" href="less/index.css">
        <link rel="stylesheet" href="assets/nprogress/nprogress.css">
        <link rel="stylesheet" href="less/bootstrap-table.css">
        <script src="assets/nprogress/nprogress.js"></script>
        <script src="assets/jquery/jquery.min.js"></script>
    </head>
    <body>
    <!-- 侧边栏 -->
    <div class="aside">
    	<div class="profile">
    		<div class="avatar img-circle">
    			<img src="./images/my_logo.jpg" alt="">
    		</div>
    		<h4>张学友</h4>
    	</div>
    	 <div class="navs">
    	<ul class="list-unstyled">
    		<li class="active"><a href="index.html"><i class="fa fa-user"></i>用户管理</a></li>
    		<li><a href="javascript:;"><i class="fa fa-bars">
    		</i>分类管理</a>
            <ul class="list-unstyled">
            	<li><a href="categoryFirst.html">一级分类管理</a></li>
            	<li><a href="categorySecond.html">二级分类管理</a></li>
            </ul>
            </li>
            <li><a href="productList.html"><i class="fa fa-product-hunt"></i>商品管理</a>
            </li>
            <li><a href="showProductList.html"><i class="fa fa-user"></i>报表管理</a></li>
    	</ul>
    </div>
    </div>
    <!-- 主体 -->
    <div class="main">
    <div class="container-fluid">
        <!-- 头部 -->
        <div class="header">
            <nav class="navbar navbar-custom">
                <div class="navbar-header">
                    <a href="javascript:;" class="navbar-brand">
                        <i class="fa fa-navicon"></i>
                    </a>
                </div>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="javascript:;" class="login_out_bot" data-toggle="modal" data-target=".bs-example-modal-sm">
                            <i class="fa fa-sign-out"></i>
                            退出
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="body teacher-profile">
            <div class="profile">
                <div class="chart">
                    <div id="main" >

                        <a href="#" class="btn btn-primary" data-target="#productWindowId" data-toggle="modal">添加商品</a>

                        <table id="productTableId"></table>

                        <div class="modal fade" id="productWindowId" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                        <h4 class="modal-title" id="myModalLabel">商品添加</h4>
                                    </div>
                                    <div class="modal-body">
                                        <form id="productFormId">
                                            <div class="form-group">
                                                <div class="dropdown">
                                                    请选择所属品牌:
                                                    <button class="btn btn-default dropdown-toggle" type="button" id="productMenuButtonId" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                        <span class="caret"></span>
                                                    </button>
                                                    <ul class="dropdown-menu" id="productMenuId">

                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="proNameId">商品名称</label>
                                                <input type="text" class="form-control" name="proName" id="proNameId" placeholder="请输入商品的名称">
                                            </div>
                                            <div class="form-group">
                                                <label for="oldPriceId">商品原价</label>
                                                <input type="text" class="form-control" name="oldPrice" id="oldPriceId" placeholder="请输入商品原价">
                                            </div>
                                            <div class="form-group">
                                                <label for="priceId">商品优惠价</label>
                                                <input type="text" class="form-control" name="price" id="priceId" placeholder="请输入商品优惠价">
                                            </div>
                                            <div class="form-group">
                                                <label for="numId">商品库存</label>
                                                <input type="text" class="form-control" name="num" id="numId" placeholder="请输入商品库存">
                                            </div>
                                            <div class="form-group">
                                                <label for="sizeId">商品尺寸</label>
                                                <input type="text" class="form-control"  name="size" id="sizeId" placeholder="请输入商品尺寸比如 20-40">
                                            </div>
                                            <div class="form-group">
                                                <label for="descId">商品描述</label>
                                                <input type="text" class="form-control" name="proDesc" id="descId" placeholder="请输入商品描述">
                                            </div>
                                            <!--文件上传，图片.-->
                                            <div class="form-group">
                                                <a href="#" class="input_style_file_upload">
                                                     请选择商品图片
                                                     <!--我要指定多个参数.-->
                                                     <input type="file" name="pic1" class="form-control" id="fileId" data-url="/product/addProductPic" multiple>
                                                </a>
                                            </div>
                                            <div id="productImgViewId" style="overflow: hidden;opacity: 0;">

                                            </div>
                                        </form>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default cancelProductBtn" data-dismiss="modal">关闭</button>
                                        <button type="button" class="btn btn-primary okProductBtn">确定</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    </body>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="js/bootstrap-table.js"></script>
    <script src="js/bootstrap-table-zh-CN.js"></script>
    <script src="assets/jquery-fileupload/jquery.iframe-transport.js"></script>
    <script src="assets/jquery-fileupload/jquery.ui.widget.js"></script>
    <script src="assets/jquery-fileupload/jquery.fileupload.js"></script>
    <script src="js/common.js"></script>
    <script>
        $("#productTableId").bootstrapTable({
        	method:"get",
        	url:"/product/queryProductDetailList",
        	queryParams:function(params){
        		params.page = (params.offset/10)+1;
        		params.pageSize = 10;
        		return params;
        	},
        	pagination:true,
        	pageList:[10],
        	sidePagination:"server",
        	columns:[{
        		checkbox:true
        	},{
                     title:"商品编号",
                     field:"id"
                 },
                 {
                     title:"商品名称",
                     field:"proName"
                 },
                 {
                     title:"商品原价",
                     field:"oldPrice"
                 },
                 {
                     title:"优惠价",
                     field:"price"
                 },
                 {
                     title:"商品库存",
                     field:"num"
                 },
                 {
                     title:"操作",
                     field:"operation"
                 }
            ]
        });
 $("#fileId").fileupload({
             autoLoad:"true",
             done:function(e,data){

                  params.pics.push(data._response.result);
                  var img=document.createElement("img");
                   img.src=data._response.result.picAddr;
                   img.style.width="100px";
                   img.style.width="100px";
                   img.style.margin="5px";
                   img.style.float="left";
                   img.style.border="2px solid #ccc";
                   $("#productImgViewId").animate({opacity:1,"marginLeft":"100px"},1000);
                   $("#productImgViewId").append(img);
             }
        })

        //填充品牌对应的数据.
        $.ajax({
            url:"/category/querySecondCategoryPaging",
            type:"GET",
            data:{
                page:1,
                pageSize:100
            },
            success:function(data){
                  var arr=[];
                  for(var i=0;i<data.rows.length;i++){
                      var li="<li><a href='#' id='"+data.rows[i].id+"'>"+data.rows[i].brandName+"</a></li>"
                      arr.push(li);
                  }
                  var html=arr.join("");
                  $("#productMenuId").html(html);
            }
        })

        //品牌的下拉框选中
        $("#productMenuId").on("click","a",function(){
                 var text=$(this).text();
                 //选中的品牌的id ，我要存起来.
                 params.brandId=this.id;
                 console.log(params);
                 $("#productMenuButtonId")[0].firstChild.nodeValue=text;
        });

        
        /*点击确定，添加商品数据.*/
        $(".okProductBtn").on("click",function(){
               //获取表单里面用户输入的数据.  serialize 序列化
               var data=$("#productFormId").serialize();
               //以及图片上传的数据. //jQuery 有一个方法，一次可以获取所有的表单项的数据.
               data=data+"&brandId="+params.brandId;
               //将三张图片的数据组装成字符串，发送给服务器. 拼这个地址的时候我们是需要跟后台沟通的
                data+="&picName1="+params.pics[0].picName+"&picAddr1="+params.pics[0].picAddr;
                data+="&picName2="+params.pics[1].picName+"&picAddr2="+params.pics[1].picAddr;
                data+="&picName3="+params.pics[2].picName+"&picAddr3="+params.pics[2].picAddr;
                data+="&statu=1";
                $.ajax({
                    type:"POST",
                    url:"/product/addProduct",
                    data:data,
                    success:function(data){
                         if(data.success){
                              //关闭弹出框
                              $(".cancelProductBtn").click();
                              //刷新表格
                              $("#productTableId").bootstrapTable("refresh");
                         }
                    }
                })
        });


    </script>
</html>